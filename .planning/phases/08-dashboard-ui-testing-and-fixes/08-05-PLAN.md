---
phase: 08-dashboard-ui-testing-and-fixes
plan: 05
type: execute
wave: 3
depends_on: [08-01, 08-02, 08-03, 08-04]
files_modified:
  - tests/ui/test_dashboard_e2e.py
autonomous: true

must_haves:
  truths:
    - "Every dashboard page loads without errors (200 status)"
    - "Every navigation link works (no broken routes)"
    - "Empty states render correctly (no crashes on empty data)"
    - "HTMX refresh endpoints work for all tables"
  artifacts:
    - path: "tests/ui/test_dashboard_e2e.py"
      provides: "End-to-end tests for all dashboard pages"
      min_lines: 200
      contains: "TestDashboardPages, TestHTMXInteractions, TestEmptyStates"
  key_links:
    - from: "tests/ui/test_dashboard_e2e.py"
      to: "httpx.AsyncClient with ASGITransport"
      via: "Follows pattern from test_dashboard.py"
      pattern: "ASGITransport.*AsyncClient"
    - from: "tests/ui/test_dashboard_e2e.py"
      to: "DashboardApp"
      via: "Creates test app with in-memory SQLite"
      pattern: "create_dashboard_app.*sqlite.*memory"
---

<objective>
Create comprehensive E2E tests for all Dashboard pages to verify pages load, navigation works, and HTMX interactions function.

Purpose: Existing dashboard tests (test_dashboard.py) test helper functions and basic routes. Need comprehensive E2E tests for:
- Every page load (/, /workflows, /agents, /optimization/experiments, /optimization/compare, /mlflow)
- Navigation links
- HTMX table refresh endpoints
- Empty state rendering

NOTE: DASH-03 "Experiments page" refers to /optimization/experiments (not /experiments), which is tested in this plan.

Output: Comprehensive E2E test file marked as @pytest.mark.slow for manual/pre-release testing.
</objective>

<execution_context>
@C:\Users\ghost\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\ghost\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-ui-testing-and-fixes/08-CONTEXT.md

# Existing test patterns
@tests/ui/test_dashboard.py
@tests/conftest.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Create test_dashboard_e2e.py with comprehensive page load tests</name>
  <files>tests/ui/test_dashboard_e2e.py</files>
  <action>
    Create new file with following test classes:

    **Class TestDashboardPageLoads (all marked @pytest.mark.slow):**
    - `test_dashboard_home_page_200` - GET / returns 200, HTML content
    - `test_workflows_page_200` - GET /workflows returns 200, HTML content
    - `test_agents_page_200` - GET /agents returns 200, HTML content
    - `test_experiments_page_200` - GET /optimization/experiments returns 200
    - `test_optimization_compare_without_mlflow` - GET /optimization/compare shows friendly message
    - `test_mlflow_unavailable_page_200` - GET /mlflow returns friendly page (not JSON 404)
    - `test_health_endpoint` - GET /health returns JSON with status

    **Class TestNavigationLinks:**
    - `test_dashboard_contains_nav_links` - Verify all nav links present in HTML
    - `test_nav_links_work` - Each nav link returns 200 (parse HTML, extract links, verify)

    **Class TestHTMXEndpoints:**
    - `test_workflows_table_htmx` - GET /workflows/table returns HTML partial
    - `test_agents_table_htmx` - GET /agents/table returns HTML partial
    - `test_workflows_stream_sse` - GET /metrics/workflows/stream returns text/event-stream
    - `test_agents_stream_sse` - GET /metrics/agents/stream returns text/event-stream

    **Class TestEmptyStates:**
    - `test_workflows_empty_state` - With no workflows, shows "No workflows found"
    - `test_agents_empty_state` - With no agents, shows "No agents found"

    Follow httpx.AsyncClient pattern from existing test_dashboard.py:

    ```python
    from httpx import AsyncClient, ASGITransport
    import pytest
    from configurable_agents.ui.dashboard import create_dashboard_app

    @pytest.mark.slow
    @pytest.mark.asyncio
    class TestDashboardPageLoads:
        @pytest.fixture
        async def client(self):
            dashboard = create_dashboard_app(db_url="sqlite:///:memory:")
            transport = ASGITransport(app=dashboard.app)
            async with AsyncClient(transport=transport, base_url="http://test") as ac:
                yield ac

        async def test_dashboard_home_page_200(self, client):
            response = await client.get("/")
            assert response.status_code == 200
            assert "text/html" in response.headers.get("content-type", "")
    ```
  </action>
  <verify>
    test_dashboard_e2e.py exists with at least 15 test methods covering all pages. Run tests: `pytest tests/ui/test_dashboard_e2e.py -v -m slow --count=3` and confirm they pass.
  </verify>
  <done>
    Comprehensive E2E tests exist for all dashboard pages and interactions
  </done>
</task>

</tasks>

<verification>
1. Run E2E tests: `pytest tests/ui/test_dashboard_e2e.py -v -m slow`
2. Verify all tests pass (or skip with clear reasons)
3. Check test coverage includes all pages
4. Verify HTMX endpoints tested
5. Verify empty states tested
</verification>

<success_criteria>
- All dashboard pages have E2E tests
- Navigation links tested
- HTMX endpoints tested
- Empty states tested
- Tests marked as @pytest.mark.slow
- Tests pass with fixes from 08-01 through 08-04
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-ui-testing-and-fixes/08-05-SUMMARY.md`
</output>
