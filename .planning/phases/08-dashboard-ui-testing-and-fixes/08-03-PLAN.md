---
phase: 08-dashboard-ui-testing-and-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/configurable_agents/ui/dashboard/app.py
  - src/configurable_agents/ui/dashboard/templates/mlflow_unavailable.html
autonomous: true

must_haves:
  truths:
    - "Visiting /mlflow when not mounted shows friendly message (not JSON 404)"
    - "MLFlow link in navigation shows helpful message when unavailable"
    - "Dashboard continues working when MLFlow is not installed or not mounted"
  artifacts:
    - path: "src/configurable_agents/ui/dashboard/app.py"
      provides: "MLFlow availability check and graceful 404 handling"
      contains: "mlflow_mounted"
    - path: "src/configurable_agents/ui/dashboard/templates/mlflow_unavailable.html"
      provides: "Friendly MLFlow not configured page"
      min_lines: 20
  key_links:
    - from: "src/configurable_agents/ui/dashboard/app.py"
      to: "/mlflow route"
      via: "Check if MLFlow mounted before returning 404"
      pattern: "mlflow.*mount|@app\\.get\\('/mlflow"
    - from: "src/configurable_agents/ui/dashboard/templates/base.html"
      to: "MLFlow navigation link"
      via: "Link exists but shows message if unavailable"
      pattern: "href=.*/mlflow"
---

<objective>
Fix MLFlow page 404 error by adding friendly unavailable page and mount status checking.

Purpose: MLFlow navigation link returns generic JSON 404 `{detail: Not found}` when MLFlow is not mounted. Need friendly HTML page explaining MLFlow is not configured and how to enable it.

Output: Friendly MLFlow unavailable page with clear guidance, navigation still works.
</objective>

<execution_context>
@C:\Users\ghost\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\ghost\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-ui-testing-and-fixes/08-CONTEXT.md
@.planning/UI_BUG_REPORT.md

# Current MLFlow handling
@src/configurable_agents/ui/dashboard/app.py
@src/configurable_agents/ui/dashboard/templates/base.html
</context>

<tasks>

<task type="auto">
  <name>Create mlflow_unavailable.html template</name>
  <files>src/configurable_agents/ui/dashboard/templates/mlflow_unavailable.html</files>
  <action>
    Create new file with:

    1. Extends base.html
    2. Friendly heading: "MLFlow Not Configured"
    3. Clear explanation paragraphs:
       - "MLFlow is not currently enabled for this dashboard."
       - "To enable MLFlow tracking, restart the dashboard with the --mlflow flag:"
       - Code block: `configurable-agents ui --mlflow`
       - "Or use an external MLFlow server:"
       - Code block: `configurable-agents ui --mlflow-uri <your-uri>`
    4. Navigation link back to main dashboard
    5. Use existing CSS classes for consistency

    Keep it simple and helpful. No complex layout - just clear messaging.
  </action>
  <verify>
    mlflow_unavailable.html exists with helpful message and navigation
  </verify>
  <done>
    MLFlow unavailable page exists with clear guidance
  </done>
</task>

<task type="auto">
  <name>Add MLFlow mount tracking and fallback route</name>
  <files>src/configurable_agents/ui/dashboard/app.py</files>
  <action>
    NOTE: This task edits `_mount_mlflow()` method (line ~146) and `_create_main_dashboard_routes()` method (line ~172). These are different sections from 08-01's `_setup_templates()` edits, so parallel execution is safe.

    In `DashboardApp.__init__`, add instance variable to track MLFlow mount status:

    ```python
    # After line 58 (self.mlflow_tracking_uri = ...)
    self.mlflow_mounted = mlflow_tracking_uri is not None
    ```

    Update `_mount_mlflow()` to set flag based on success:

    ```python
    def _mount_mlflow(self, mlflow_tracking_uri: str) -> None:
        """Mount MLFlow WSGI application at /mlflow."""
        try:
            from mlflow.server.app import create_app
            from fastapi.middleware.wsgi import WSGIMiddleware

            # Create MLFlow app
            mlflow_app = create_app(
                backend_store_uri=mlflow_tracking_uri,
                default_artifact_root=mlflow_tracking_uri.replace("file://", "") + "/artifacts",
            )

            # Mount at /mlflow
            self.app.mount("/mlflow", WSGIMiddleware(mlflow_app))
            self.mlflow_mounted = True

        except ImportError:
            self.mlflow_mounted = False
        except Exception as e:
            import logging
            logging.getLogger(__name__).warning(f"Failed to mount MLFlow: {e}")
            self.mlflow_mounted = False
    ```

    Add fallback route in `_create_main_dashboard_routes()`:

    ```python
    @self.app.get("/mlflow", response_class=HTMLResponse)
    async def mlflow_unavailable(request: Request):
        """Show friendly page when MLFlow is not mounted."""
        return self.templates.TemplateResponse(
            "mlflow_unavailable.html",
            {"request": request}
        )
    ```

    FastAPI routes take precedence over mounts, so this route will serve the friendly page when MLFlow is not mounted.
  </action>
  <verify>
    app.py tracks MLFlow mount status (mlflow_mounted attribute) and provides /mlflow fallback route
  </verify>
  <done>
    /mlflow shows friendly page when not mounted, MLFlow UI when mounted
  </done>
</task>

</tasks>

<verification>
1. Start dashboard WITHOUT MLFlow: `configurable-agents ui --dashboard-port-only 7861`
2. Visit http://localhost:7861/mlflow
3. Verify friendly "MLFlow Not Configured" page displays
4. Verify page includes instructions for --mlflow flag
5. Click navigation links to verify rest of dashboard still works
</verification>

<success_criteria>
- /mlflow shows friendly HTML page when MLFlow not mounted
- Page includes instructions for enabling MLFlow
- No JSON 404 error
- Navigation still works
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-ui-testing-and-fixes/08-03-SUMMARY.md`
</output>
