---
phase: 08-dashboard-ui-testing-and-fixes
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/configurable_agents/ui/dashboard/routes/optimization.py
  - src/configurable_agents/ui/dashboard/templates/optimization.html
autonomous: true

must_haves:
  truths:
    - "Optimization page loads without MLFlow filesystem errors"
    - "Page shows helpful message when MLFlow unavailable"
    - "MLFlow-dependent features disabled gracefully when unavailable"
    - "No WinError 2 or filesystem errors in logs"
  artifacts:
    - path: "src/configurable_agents/ui/dashboard/routes/optimization.py"
      provides: "Error handling for MLFlow backend failures"
      contains: "try/except ImportError, FileNotFoundError"
    - path: "src/configurable_agents/ui/dashboard/templates/optimization.html"
      provides: "Graceful degradation UI when MLFlow unavailable"
      contains: "{% if mlflow_available %}"
  key_links:
    - from: "src/configurable_agents/ui/dashboard/routes/optimization.py"
      to: "MLFlow client"
      via: "Wrapped in try/except with mlflow_available flag"
      pattern: "mlflow_available.*try.*ImportError"
    - from: "src/configurable_agents/ui/dashboard/templates/optimization.html"
      to: "mlflow_available context variable"
      via: "Conditional rendering of MLFlow-dependent features"
      pattern: "if.*mlflow_available"
---

<objective>
Fix Optimization page MLFlow filesystem errors with graceful degradation when MLFlow unavailable.

Purpose: Optimization page fails with `[WinError 2] The system cannot find the file specified: '\\.\mlruns'` when MLFlow backend not configured. Need error handling and friendly fallback.

Output: Optimization page works without MLFlow, shows helpful message, disables MLFlow-dependent features.
</objective>

<execution_context>
@C:\Users\ghost\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\ghost\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-ui-testing-and-fixes/08-CONTEXT.md
@.planning/UI_BUG_REPORT.md

# Current optimization route and template
@src/configurable_agents/ui/dashboard/routes/optimization.py
@src/configurable_agents/ui/dashboard/templates/optimization.html
</context>

<tasks>

<task type="auto">
  <name>Add MLFlow availability checking to optimization routes</name>
  <files>src/configurable_agents/ui/dashboard/routes/optimization.py</files>
  <action>
    Update `experiments_list()` and `compare_page()` functions to:
    1. Check MLFlow availability BEFORE attempting operations
    2. Pass `mlflow_available` flag to templates
    3. Return early with friendly state when unavailable

    For `experiments_list()` (lines 40-90):
    - Already has try/except for ImportError - keep this
    - Add explicit handling for FileNotFoundError (Windows filesystem error)
    - Add to except block: `except (ImportError, FileNotFoundError, OSError) as e:`
    - Log the error appropriately but set `mlflow_available = False`

    For `compare_page()` (lines 130-175):
    - Wrap the `ExperimentEvaluator()` call in try/except
    - Catch `OSError, FileNotFoundError, ImportError`
    - Set `error = "MLFlow is not available or not configured"` on these errors
    - Pass `mlflow_available=False` to template context

    For `experiments_json()` (lines 93-127):
    - Same error handling as experiments_list

    For `compare_json()` (lines 178-205):
    - Wrap evaluator call in try/except
    - Return `{"error": "...", "mlflow_available": False}` on failure
  </action>
  <verify>
    optimization.py has try/except blocks handling ImportError, FileNotFoundError, OSError
  </verify>
  <done>
    MLFlow errors caught and mlflow_available flag set appropriately
  </done>
</task>

<task type="auto">
  <name>Add graceful degradation UI to optimization.html</name>
  <files>src/configurable_agents/ui/dashboard/templates/optimization.html</files>
  <action>
    Add conditional rendering for when MLFlow is unavailable.

    After line 141 (after `{% block content %}`), add:

    ```jinja
    {% if not mlflow_available %}
    <div class="alert alert-warning" style="padding: 20px; margin: 20px 0; border-radius: 8px;">
        <h2>MLFlow Not Available</h2>
        <p>The optimization features require MLFlow to be configured.</p>

        <h3>To enable MLFlow:</h3>
        <ul>
            <li>Install MLFlow: <code>pip install mlflow</code></li>
            <li>Start the dashboard with the <code>--mlflow</code> flag:
                <code>configurable-agents ui --mlflow</code>
            </li>
            <li>Or specify an external MLFlow server:
                <code>configurable-agents ui --mlflow-uri <your-uri></code>
            </li>
        </ul>

        <p><a href="/optimization/experiments" class="btn-secondary">Refresh Status</a></p>
    </div>
    {% else %}
    ```

    Add `{% endif %}` before final `{% endblock %}` (wrap existing content).

    Also update the error display (lines 151-155) to check if it's an MLFlow availability error:
    ```jinja
    {% if error %}
    <div class="alert alert-danger">
        {% if 'MLFlow' in error or 'mlflow' in error %}
        <strong>MLFlow Error:</strong> {{ error }}
        <p>Please ensure MLFlow is configured and accessible.</p>
        {% else %}
        <strong>Error:</strong> {{ error }}
        {% endif %}
    </div>
    {% endif %}
    ```
  </action>
  <verify>
    optimization.html has conditional {% if not mlflow_available %} block
  </verify>
  <done>
    Optimization page shows friendly message when MLFlow unavailable
  </done>
</task>

</tasks>

<verification>
1. Start dashboard WITHOUT MLFlow: `configurable-agents ui --dashboard-port-only 7861`
2. Visit http://localhost:7861/optimization/experiments
3. Verify page loads without filesystem errors
4. Verify friendly "MLFlow Not Available" message displays
5. Visit http://localhost:7861/optimization/compare?experiment=test
6. Verify page shows error message (not crash)
</verification>

<success_criteria>
- Optimization page loads without MLFlow filesystem errors
- Friendly message shown when MLFlow unavailable
- No OSError or FileNotFoundError exceptions
- MLFlow-dependent features disabled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-ui-testing-and-fixes/08-04-SUMMARY.md`
</output>
