# Article Generation Flow Configuration

flow:
  name: "article_generation_flow"
  description: "Research a topic and generate a validated article"

# Global LLM defaults (uses MODEL env var by default)
defaults:
  llm:
    provider: "google"
    # model not specified here, will use MODEL env var
    temperature: 0.7
    max_tokens: 4000

# State management
state:
  common_vars:
    - execution_id
    - execution_status
    - execution_message
    - timestamp
    - current_step

# Flow execution steps
steps:
  - id: "research_topic"
    is_start: true
    type: "crew"
    crew_ref: "research_crew"
    next_step: "write_and_validate_article"
    inputs:
      topic: "{state.custom_var.topic}"
    output_to_state: "state.custom_var.research_report"

  - id: "write_and_validate_article"
    type: "crew"
    crew_ref: "writer_crew"
    next_step: null  # End of flow
    inputs:
      topic: "{state.custom_var.topic}"
      research_report: "{state.custom_var.research_report}"
    output_to_state: "state.custom_var.final_output"

# Crew definitions
crews:
  research_crew:
    llm:
      temperature: 0.5
    
    agents:
      - id: "topic_researcher"
        role: "Topic Researcher"
        goal: "Research the topic '{topic}' and compile a concise 100-word report"
        backstory: >
          You are an expert researcher with a talent for distilling complex 
          information into clear, concise summaries. You have access to vast 
          knowledge and can quickly identify the most important aspects of any topic.
        tools: ["serper_search"]
        
    tasks:
      - id: "research_task"
        description: >
          Research the topic: {topic}
          Compile a comprehensive yet concise report of EXACTLY 100 words.
          Focus on key facts, recent developments, and important context.
        expected_output: "A 100-word research report on the given topic"
        agent: "topic_researcher"
    
    execution:
      type: "sequential"
      tasks: ["research_task"]

  writer_crew:
    llm:
      temperature: 0.8
    
    agents:
      - id: "article_writer"
        role: "Article Writer"
        goal: "Write an engaging, well-structured article based on research"
        backstory: >
          You are a professional content writer known for creating engaging, 
          informative articles. You have a natural, human writing style that 
          connects with readers while maintaining accuracy and depth.
        tools: []
        llm:
          temperature: 0.9
        
      - id: "humanness_validator"
        role: "AI Writing Pattern Detector"
        goal: "Analyze articles for AI writing patterns and provide humanness scores"
        backstory: >
          You are an expert in detecting AI-generated content. You can identify 
          telltale signs of AI writing such as repetitive patterns, unnatural 
          phrasing, over-formal tone, and lack of personal voice. You provide 
          detailed feedback and accurate humanness scores.
        tools: []
        llm:
          temperature: 0.3
        
    tasks:
      - id: "write_article"
        description: >
          Write a high-quality article on the topic: {topic}
          
          Use the following research as your foundation:
          {research_report}
          
          Requirements:
          - 400-600 words in length
          - Engaging introduction and strong conclusion
          - Natural, conversational tone
          - Well-structured with clear paragraphs
          - Avoid AI writing patterns (repetition, overly formal language, clichés)
          - Write like a human with personality and voice
        expected_output: "A well-written, engaging article of 400-600 words"
        agent: "article_writer"
      
      - id: "validate_humanness"
        description: >
          Analyze the article for AI writing patterns and provide a humanness assessment.
          
          Evaluation criteria:
          1. Natural flow and readability
          2. Presence of personal voice and style
          3. Absence of repetitive AI patterns
          4. Appropriate use of transitions
          5. Authentic tone (not overly formal or robotic)
          6. Varied sentence structure
          7. Absence of common AI phrases/clichés
          
          Provide:
          - The complete article text
          - Detailed feedback on what makes it sound human or AI-like
          - Specific examples of issues if found
          - A humanness score from 1-10 (1=obviously AI, 10=indistinguishable from human)
        expected_output: "Validation results with article, feedback and humanness score"
        agent: "humanness_validator"
        context: ["write_article"]  # ← NEW: Automatically receive article from previous task
        output_model:
          name: "ArticleValidationOutput"
          fields:
            - name: "article"
              type: "str"
              description: "The complete article text"
            - name: "feedback"
              type: "str"
              description: "Detailed feedback on humanness and AI patterns detected"
            - name: "humanness_score"
              type: "int"
              description: "Score from 1-10 indicating how human-like the writing is"
    
    execution:
      type: "sequential"
      tasks: ["write_article", "validate_humanness"]