# ${workflow_name} - Deployed Workflow

**Generated by**: configurable-agents deploy command
**Container**: ${container_name}
**Ports**: API=${api_port}, MLFlow=${mlflow_port}

---

## Quick Start

### 1. Start Container

```bash
docker-compose up -d
```

**OR** (without docker-compose):

```bash
docker run -d \\
  --name ${container_name} \\
  -p ${api_port}:${api_port} \\
  -p ${mlflow_port}:${mlflow_port} \\
  --env-file .env \\
  -v $$(pwd)/mlflow.db:/app/mlflow.db \\
  ${container_name}:latest
```

### 2. Call Workflow

```bash
curl -X POST http://localhost:${api_port}/run \\
  -H "Content-Type: application/json" \\
  -d '${example_input}'
```

**Response (sync, <${sync_timeout}s)**:
```json
{
  "status": "success",
  "execution_time_ms": 2340,
  "outputs": {
    "article": "...",
    "word_count": 500
  }
}
```

**Response (async, >${sync_timeout}s)**:
```json
{
  "status": "async",
  "job_id": "a3f9b2c1-d4e5-6789-0123-456789abcdef",
  "message": "Workflow exceeds ${sync_timeout}s timeout. Poll /status/{job_id}"
}
```

### 3. View Traces (MLFlow UI)

```bash
open http://localhost:${mlflow_port}
```

---

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/` | GET | API information |
| `/run` | POST | Execute workflow (sync/async) |
| `/status/{job_id}` | GET | Check async job status |
| `/health` | GET | Health check |
| `/schema` | GET | Workflow input/output schema |
| `/docs` | GET | Interactive OpenAPI docs |

### POST /run

Execute workflow with sync/async fallback.

**Request**:
```bash
curl -X POST http://localhost:${api_port}/run \\
  -H "Content-Type: application/json" \\
  -d '${example_input}'
```

**Success (sync)**:
```json
{
  "status": "success",
  "execution_time_ms": 2340,
  "outputs": {...}
}
```

**Timeout (async)**:
```json
{
  "status": "async",
  "job_id": "uuid-here",
  "message": "Poll /status/{job_id}"
}
```

### GET /status/{job_id}

Poll async job status.

**Request**:
```bash
curl http://localhost:${api_port}/status/a3f9b2c1-d4e5-6789-0123-456789abcdef
```

**Response**:
```json
{
  "job_id": "a3f9b2c1-d4e5-6789-0123-456789abcdef",
  "status": "completed",
  "created_at": "2026-01-30T14:30:00Z",
  "completed_at": "2026-01-30T14:31:05Z",
  "execution_time_ms": 65000,
  "outputs": {...}
}
```

**Status values**: `pending`, `running`, `completed`, `failed`

### GET /health

Health check for orchestration.

**Request**:
```bash
curl http://localhost:${api_port}/health
```

**Response**:
```json
{
  "status": "healthy",
  "timestamp": "2026-01-30T14:35:00Z"
}
```

### GET /schema

Workflow input/output schema.

**Request**:
```bash
curl http://localhost:${api_port}/schema
```

**Response**:
```json
{
  "workflow": "${workflow_name}",
  "inputs": {
    "topic": {
      "type": "str",
      "required": true,
      "default": null,
      "description": "Topic to write about"
    }
  },
  "outputs": ["article", "word_count"]
}
```

---

## Container Management

### View Logs

```bash
docker logs ${container_name}
docker logs -f ${container_name}  # Follow (live tail)
```

### Stop Container

```bash
docker stop ${container_name}
```

### Restart Container

```bash
docker restart ${container_name}
```

### Remove Container

```bash
docker rm -f ${container_name}  # -f to force stop if running
```

### View Resource Usage

```bash
docker stats ${container_name}
```

---

## Environment Variables

**Required**:
- `GOOGLE_API_KEY`: Google Gemini API key
- `SERPER_API_KEY`: Serper search API key (if using serper_search tool)

**Configuration**:

1. **Copy template**:
   ```bash
   cp .env.example .env
   ```

2. **Edit .env** and add your API keys

3. **Restart container** to apply changes:
   ```bash
   docker-compose restart
   ```

---

## MLFlow Observability

View workflow traces, costs, and performance metrics at:

**URL**: http://localhost:${mlflow_port}

**Features**:
- View all workflow executions
- Inspect prompts and responses
- Track token usage and costs
- Compare runs
- Export data (CSV, JSON)

**Persistence**: Traces are stored in `./mlflow.db` (SQLite) and survive container restarts.

---

## Production Deployment

### Set Resource Limits

```bash
docker run -d \\
  --memory="512m" \\
  --cpus="1.0" \\
  -p ${api_port}:${api_port} \\
  ${container_name}:latest
```

### Configure Restart Policy

```bash
docker run -d \\
  --restart=unless-stopped \\
  -p ${api_port}:${api_port} \\
  ${container_name}:latest
```

### Tag for Registry

```bash
docker tag ${container_name}:latest myregistry.com/${container_name}:1.0.0
docker push myregistry.com/${container_name}:1.0.0
```

---

## Troubleshooting

### Container Won't Start

**Check logs**:
```bash
docker logs ${container_name}
```

**Common issues**:
- Missing API keys: Set `GOOGLE_API_KEY` in .env
- Port already in use: Change port in docker-compose.yml
- Invalid workflow config: Validate before deploy

### Workflow Fails at Runtime

**Check MLFlow UI**: http://localhost:${mlflow_port}

**Check container logs**:
```bash
docker logs -f ${container_name}
```

### Port Already in Use

**Find process**:
```bash
# Linux/Mac
lsof -i :${api_port}

# Windows
netstat -ano | findstr :${api_port}
```

**Solution**: Kill process or change port in docker-compose.yml

---

## Next Steps

- **Call API**: Use curl, Postman, or Python requests
- **View traces**: Open MLFlow UI to inspect execution
- **Scale**: Run multiple containers behind load balancer
- **Deploy to cloud**: AWS ECS, Google Cloud Run (v0.2+)

---

## Resources

- **OpenAPI Docs**: http://localhost:${api_port}/docs
- **MLFlow UI**: http://localhost:${mlflow_port}
- **configurable-agents Docs**: https://github.com/yourusername/configurable-agents

---

**Generated**: ${generated_at}
**Workflow Version**: ${workflow_version}
