{% extends "base.html" %}

{% block title %}Workflows - Configurable Agents Dashboard{% endblock %}

{% block nav_workflows %}class="active"{% endblock %}

{% block content %}
<div class="dashboard-container">
    <header class="page-header">
        <h1>Workflows</h1>
        <p class="subtitle">Monitor workflow executions and metrics</p>
    </header>

    <!-- Filters -->
    <div class="table-container">
        <div class="table-header">
            <h2>Workflow Runs</h2>
            <div class="filters">
                <div class="filter-group">
                    <label for="status-filter">Status:</label>
                    <select id="status-filter" name="status"
                            hx-get="/workflows/table"
                            hx-trigger="change"
                            hx-include="[name='status']"
                            hx-target="#workflows-table"
                            hx-swap="innerHTML">
                        <option value="">All</option>
                        <option value="running" {% if status_filter == 'running' %}selected{% endif %}>Running</option>
                        <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
                        <option value="failed" {% if status_filter == 'failed' %}selected{% endif %}>Failed</option>
                        <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Workflows Table with HTMX auto-refresh -->
        <div id="workflows-table"
             hx-get="/workflows/table"
             hx-swap="outerHTML"
             hx-trigger="load, every 5s"
             hx-include="[name='status']">
            {% include "workflows_table.html" %}
        </div>
    </div>
</div>

<!-- SSE Connection for Real-time Updates -->
<div hx-ext="sse" sse-connect="/metrics/workflows/stream" sse-swap="workflow_update" style="display: none;">
    <!-- SSE events will trigger table refresh automatically -->
</div>

<script>
    // Listen for SSE messages and refresh table on update
    document.body.addEventListener('workflow_update', function(evt) {
        console.log('Workflow update received');
        // HTMX SSE extension handles the swap automatically
    });
</script>
{% endblock %}
