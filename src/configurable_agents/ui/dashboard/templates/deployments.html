{% extends "base.html" %}

{% block title %}Deployments - Configurable Agents Dashboard{% endblock %}

{% block nav_deployments %}class="active"{% endblock %}

{% block content %}
<div class="dashboard-container">
    <header class="page-header">
        <h1>Registered Deployments</h1>
        <p class="subtitle">View and manage registered deployments</p>
    </header>

    <!-- Actions -->
    <div class="table-container">
        <div class="table-header">
            <h2>Deployment Registry</h2>
            <div class="filters">
                <button class="btn btn-secondary"
                        onclick="window.location.reload()">
                    Refresh
                </button>
                <a href="/deployments/all" class="btn btn-secondary">Show All</a>
            </div>
        </div>

        <!-- Deployments Table with HTMX auto-refresh -->
        <div id="deployments-table"
             hx-get="/deployments/table"
             hx-swap="outerHTML"
             hx-trigger="every 10s">
            {% include "deployments_table.html" %}
        </div>
    </div>
</div>

<!-- SSE Connection for Real-time Updates -->
<div hx-ext="sse" sse-connect="/metrics/deployments/stream" sse-swap="deployment_update" style="display: none;">
    <!-- SSE events will trigger table refresh automatically -->
</div>

<script>
    // Listen for SSE messages and refresh table on update
    document.body.addEventListener('deployment_update', function(evt) {
        console.log('Deployment update received');
        // HTMX SSE extension handles the swap automatically
    });
</script>
{% endblock %}
